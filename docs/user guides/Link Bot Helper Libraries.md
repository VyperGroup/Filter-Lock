# How to use the Link bot Integration Libraries

> [parent](../../../README.md)

[Dispenser V3](https://github.com/VyperGroup/Dispenser) will be my flagship implementation of Filter Bot locking when it releases

For many Discord bot frameworks, I provide helper libraries that can get you quickly get setup with the bot. I call these "Link bot Integration Libraries. It really is shrimple to setup a Filter Lock integration in your link bot.

> If you want to make your own implementation from scratch, [see the API for Filter Lock](../for%20devs/standards/API%20Endpoints%20for%20Link%20Bot%20Locking.md)

## Intializing the class

```ts
const fl = new FilterLockLinkBotIntegration`DB`({
  dbInstance: ..., // This would be what you use in your own code to access the database.
});
```

> ` DB` is the name of whatever database you want to write the implementation for. Internally, they will inherit from a base class `FilterLockLinkBotIntegration`.

> There will be type annotations if you want to learn about the object passed into the constructor. Additionally, some constructors will be documented below.

## How to setup link distribution

I provide a single method that you can import into your bot through various languages that will wrap whatever code you use to return the link:

```ts
{ // Somewhere in the scope of your handler function
  ...
  message.reply(fl.secureLink(serverId, member)); // This will take your link and attach a generated One Time Token (generated by the Filter Lock middleware) in the fragment URL, so that Filter Lock middleware would allow it to continue. By continue, I mean trading it for a PSK and finally allowing the user to access the site.
}
```

It's as shrimple as that

## Clearing deleted links

As soon as a link is deleted, you should probably remove it from Filter Lock's DB. This is especially important if the Filter Lock middleware you are using has chosen to force a limit for the number of keys a user can have assigned to them.

```ts
// Somewhere in the handler for your command that removes a link from your bot's DB
{
  ... // Most likely the removal of a link from your bot's DB and maybe logging to a channel
  fl.removeLinkFromDB(link);
}
```

> `link` being the link the user chose to delete in the command

## Functionality (behind the scenes)

- Revokes keys for banned users
- At all times there is only one key assigned to each Discord member, unless they have a special role that grants them more. For example, premium.

## Commands

If you want the generic slash command system, without the headache of making your own, I provide my own solutions!

For example:

```ts
const fl = new FilterLockLinkBotIntegration`DB`({
  ...
  defaultPermissionLevel: ..., // A Discord bit from an enumeration for the default permission level (this will inherit the types from Discord.js) in every server. By default, if omitted, this would be admin perms. Whatever is set here can be overriden by the per-server staff
});

fl.setupSlashCmds(client.commands);
```

It's as shrimple as that

The commands provided are (you don't need to implement these it already does the hard work for you):

### per-server staff commands

- /fl config ... - documented [here](https://github.com/VyperGroup/Dispenser?tab=readme-ov-file#how-the-config-system-works)
- /fl onboarding ... (look at the subheading 2x below)
- /fl regenKey - This is used to reset and remake a Sync Token. It will send you the Sync Token through an emperal message.

### User management commands

- /fl revokeUserKey `user`
- /fl blocklistUser `user` - This should do the same as revokeKey, but also prevent the user from using the bot
- /fl viewUserKeys `user?` - By default it will display all of the Access Keys and User Tokens with "`user` `key` `expiry`" with them being sorted alphanumberically. If the user argument is provided, it will show all of the keys registered with the user

### the Onboarding process

To link the bot to your Filter Lock Middleware instance through its APIs, the per-server staff must first run `/fl onboarding`. If it is already linked to another instance it will warn first and specify the instance details

Then it will DM that member asking for the Sync Token. It will have an embed with a textbox and a submit button. All you have to do is type in the Sync Token and then press the submit button. It's as shrimple as that. It will tell you if it was successfully linked or not.

###### How to get the Sync Token from the Filter Lock middleware

When you first start your web server, the Filter Lock middleware will set an onboarding token inside of a .env for you. You must use this token.

#### How to setup per-server staff roles

If you are a per-server staff with at least the permission level as set by the link bot hoster, you can change whoever can modify how the Filter Bot integration functions. You do this by changing a config: /fl config set permittedRoles ...[`user`]

#### User commands

- /fl viewKeys - View your own keys
- /fl resetKey - Revoke a key and regenerate and a new Access Key to replace it. This will resend all of the links ever assigned to you, but with the Access key attached to them.

## Low level API

This would only be used if you want to make your own custom commands rather than Dispenser providing them for you.

> If you want to get even more low level, you could interact with the [low level APIs](../for%20devs/standards/API%20Endpoints%20for%20Link%20Bot%20Locking.md)

For example:

```ts
const fl = new FilterLockIntegration`DB`({
  // API Endpoint
  licensingServer: "...",
  token: "...",
});

// This is used to wrap `TODO: ...`
fl.appendKey(link, memberID);
// `TODO: ...`
```
